## 第6章文档结构 ##
1. 模块的分割设计
	1. 功能设计
	2. Web应用程序的构成组件
	3. 组件设计
	4. 模块与包
2. 单元测试

### 模块的分割设计###
#### 功能设计 ####
在Python中，函数以及类（以下将这些内容统称为组件）等通过模块来组织，而模块由通过包进行组织。

功能设计确定了一个应用程序具备的功能，并明确了各个功能的输入输出信息。

从应用程序看，整体的输入输出信息包括了用户看得见的范畴和关联外部系统的接口以及数据库中保存的数据等。

首先，将各个子功能的业务场景记录下来。业务场景描述了用户与系统之间进行交互的行为内容，籍此明确用户向系统输入的内容与系统反馈给用户的信息。

业务场景之间的流程切换就构成了页面流转图。将每一个页面表示的功能都记录一下。如果是Web应用程序的话，一般会包括下面这些内容：

1. URL
2. HTTP方法
3. 安全（登录以及权限）
4. 输入
	1. 用户输入
	2. 读取数据库或文件内容
	3. 来自外面系统的内容
5. 输出
	1. 页面输出
	2. 写入文件或数据库
	3. 调用外部系统

接着，还需要明确输入和输出的对应关系。将输入和输出对应起来，就构成了一个子功能。子功能的测试也需要安装这样的输入输出进行验证。

复杂的子功能不能通过一次设计编码来解决，而是通过将其设计成组件之间的组合来完成。通过划分功能组件，就可以在遇到共同操作时，调用通用模块实现，减少程序之间的内部冲突。

#### Web应用程序的构成组件 ####
将功能分解到不同组件之中，需要用某一目标规范来指导。这个目标规范可以称作软件架构。

Web应用程序的软件架构中有一个叫做MVC模式非常有名。MVC将Web应用程序的用户交互部分（与用户操作相关）按照各自功能进行划分。M表示Model，主要负责功能逻辑与数据相关的部分。V表示View，负责将Model信息展示给用户。C表示Controller，根据用户的输入将Model和View联系起来。

最近的Web应用程序开发框架对Controller进行了集成，而View部分通过HTML模板与显示逻辑的形式予以实现。在Django及Pyramid中，不再明示Controller，大多数情况下，由Model、View、Template这三大模块构成。

MVC中虽不太提及Model部分，但在非纯粹的Web+DB的应用程序中，需要同外部系统进行协同工作，而且Model大多需要持久化保存。构成子功能时，Model必不可少。按这样的思路，我们将Model分为两类：

1. ApplicationModel，其是构成子功能的Model，保存应用程序当前运行的状态，一般不作持久化。
2. DomainModel，其是已经持久化（已经保存到文件、数据库）的Model。

组成Web应用程序的组件：

1. Controller：开发框架负责
2. View：负责接收用户请求并返回应答信息。主要的输入是用户的请求参数，输出是服务器应答的内容。同时还需要检查用户的输入信息，并随后路由到对应的Model或者调用对应的ApplicationModel。将结果对象按用户可以接受的形式转换成HTML，作为应答内容进行展示。
3. DomainModel：保存持久化状态的对象。在多数场合，通过RDBMS（Relationship Data Base Management System, 关系数据库管理系统）来保存该对象信息。Python可以使用的O/R映射工具中，SQLAlchemy较为有名。另外，该对象中还保存了自身状态变化的业务逻辑信息。
4. ApplicationModel：不保存永久状态，而是在一定时间内维持状态。所谓的一定时间是指Web应用程序中的一个请求使几个页面之间切换的时间。可以通过普通的类、模块中的函数进行封装。在被View调用后，执行对应的DomainModel定义的各种方法。不进行具体的业务处理，仅仅负责流程的传递。
5. ServiceGateway：表示外部服务。负责将Web API的包装、邮件发送、启动其他进程等外部系统的内容直接送入Model或者View中。
6. Utility：不保存状态，只有输入参数、返回值的功能体，代码规模大都非常小。也可能会有输入参数种类繁多、保持对象状态直到方法调用返回这样复杂的情况。但基本从输入输出的角度而言，通过其单一对象即可完成所有操作。

一个子功能涉及的诸多内容通过View将其整合成一体。首先从View那里获得信息调用ApplicationModel或者DomainModel。如果是单一DomainModel，View直接调用DomainModel即可。但如果是多个DomainModel关联，需要通过View先调用ApplicationModel。

ServiceGateway通过轻度封装的形式完成其功能，不会对应用程序的内容做修改。

ApplicationModel调用ServiceGateway，处理应用程序内在的业务逻辑。




